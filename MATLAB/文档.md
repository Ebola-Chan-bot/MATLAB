# MATLAB
MATLAB的操作都是基于数组的，但是.NET数组支持的功能极为有限。本库自定义了强化类型<code>Array(Of T)</code>，以及实现的通用接口<code>IArray</code>。几乎所有数组操作针对的都是这种数组。作为区分，对本类库的指代简称*本库*，而*MATLAB*指代MathWorks公司出品的MATLAB软件
## `Array(Of T)`
### 取得此类的实例

#### 直接使用构造函数

函数原型
```VB
Sub New(ParamArray 尺寸 As UInteger())
```
使用示例
```VB
Dim i As New Array(Of Byte)(3, 4, 5)
```
如此你将得到一个3×4×5的全零`Byte`数组

#### 直接从`System.Array`转换

函数原型
```VB
Public Overloads Shared Widening Operator CType(数组 As Array) As Array(Of T)
```
使用示例
```VB
Dim j As Array(Of Byte) = Array.CreateInstance(GetType(Byte), {3, 4, 5})
```
#### 使用`Ones`、`Zeros`或`Rand`

函数原型
```VB
Public Function Ones(Of T)(ParamArray sz As UInteger()) As Array(Of T)
Public Function Ones(ParamArray sz As UInteger()) As Array(Of Double)
Public Function Zeros(Of T)(ParamArray sz As UInteger()) As Array(Of T)
Public Function Zeros(ParamArray sz As UInteger()) As Array(Of Double)
Public Function Rand(ParamArray sz As UInteger()) As Array(Of Double)
```
使用示例
```VB
Dim c As Array(Of Double) = Ones(4, 4, 4, 4)
'得到一个4×4×4×4全1Double数组
Dim c As Array(Of Byte) = Zeros(Of Byte)(4, 4, 4, 4)
'得到一个4×4×4×4全0Byte数组
Dim b As Array(Of Double) = Rand(3, 3, 3)
'得到一个3×3×3Double数组，每个值都是(0,1)之间的随机数
```
详见模块`ElMat`
### 访问数组元素
访问数组元素主要使用默认属性`SubsRA`。元素索引和维度索引都从0开始。将多维数组展开成一维数组，或多维下标转换为线性索引时，先展开较低的维度。

上述规则可以简写为 *(1,0)=1*，即一个二维数组的下标(1,0)号元素表示为线性索引的1号元素。按照这种写法，MATLAB的索引规则是 *(2,1)=2*，而VB.NET则是 *(0,1)=1*
```VB
'取一维数组的单个元素。如果是多维数组，将先展开成一维。此处线性索引规则是(1,0)=1
Default Property SubsRA(subs As UInteger) As T
'取多维数组的单个元素。如果取值时，下标数与数组维度不匹配，将补零或截尾至匹配。如果赋值时，提供的下标数大于数组维度且多出的下标不全为0，或者某维下标超过该维上限，数组将被扩展，0填充。
Default Property SubsRA(subs As UInteger()) As T
'取多维数组的多个元素。此属性不具有健壮性，调用方应保证数组兼容此下标。
Default Property SubsRA(subs As Integer()()) As Array(Of T)
```
使用示例
```VB
Dim b As Array(Of Double) = Rand(3, 3, 3)
Console.WriteLine("原数组：")
Console.WriteLine(b)
Console.WriteLine("线性索引10号元素，对应三维下标(0,1,1)：")
Console.WriteLine(b(10))
Console.WriteLine("三维下标(0,1,2)：")
Console.WriteLine(b({0, 1, 2}))
Console.WriteLine("切取3×3×3立方体的中间一层，并多次输出其中某些行列：")
Console.WriteLine(b({({0, 0, 1, 1, 2, 2}), ({0, 0, 2, 2, 1, 2}), ({1})}))
```
输出如下：
```
原数组：
列为第0维，行为第1维
(:,:,0)
0.774854914646062 0.316221395189046 0.794848212876752
0.883035844603104 0.0577539820492985 0.348889737552446
0.224183649860408 0.220438254634122 0.505174638938706
(:,:,1)
0.715416657605868 0.615383476305466 0.97921064774469
0.474463869107172 0.0898106508375195 0.0108690951070139
0.110362981497479 0.370570718948995 0.106254618664391
(:,:,2)
0.60962582594232 0.628041571298633 0.532591792071514
0.369356038220858 0.0563983060682185 0.691998344236984
0.541576449545834 0.514543601085685 0.00845670840165424

线性索引10号元素，对应三维下标(0,1,1)：
0.474463869107172
三维下标(0,1,2)：
0.628041571298633
切取3×3×3立方体的中间一层，并多次输出其中某些行列：
列为第0维，行为第1维
0.774854914646062 0.774854914646062 0.794848212876752 0.794848212876752 0.316221395189046 0.794848212876752
0.774854914646062 0.774854914646062 0.794848212876752 0.794848212876752 0.316221395189046 0.794848212876752
0.883035844603104 0.883035844603104 0.348889737552446 0.348889737552446 0.0577539820492985 0.348889737552446
0.883035844603104 0.883035844603104 0.348889737552446 0.348889737552446 0.0577539820492985 0.348889737552446
0.224183649860408 0.224183649860408 0.505174638938706 0.505174638938706 0.220438254634122 0.505174638938706
0.224183649860408 0.224183649860408 0.505174638938706 0.505174638938706 0.220438254634122 0.505174638938706
```
### 运算符
`Array(Of T)`支持直接使用运算符运算，视为对每个元素进行对应运算，结果存储在新输出的数组中。目前支持的运算包括+ - * / = <> > <。详见`Ops`模块。
## `DataTypes`
此模块包含`[Class]`、`Cast`和`ArrayFun`3个函数
### `[Class]`
<https://ww2.mathworks.cn/help/matlab/ref/class.html>

数组元素的类
```VB
<Extension> Public Function [Class](数组 As IEnumerable) As Type
```
### `Cast`
<https://ww2.mathworks.cn/help/matlab/ref/cast.html>

将 A 转换为类 newclass，其中 newclass 是与 A 兼容的数据类型
```VB
Public Function Cast(Of TIn, newclass)(A As Array(Of TIn), Optional [like] As Array(Of newclass) = Nothing) As Array(Of newclass)
```
### `ArrayFun`
<https://ww2.mathworks.cn/help/matlab/ref/arrayfun.html>

将 func 应用于数组 A1,...,An 的元素，因此 B(i) = func(A1(i),...,An(i))。函数 func 必须接受 n 个输入参数并返回一个标量。数组 A1,...,An 的大小如果不同，较大的数组会被保留，较小的数组则会被循环填补空缺。
```VB
Public Function ArrayFun(Of T)(func As Func(Of Object(), T), ParamArray A As IArray()) As Array(Of T)
```
使用示例
```VB
Dim a As Array(Of Double) = Colon(1, -0.6, -1)
Console.WriteLine(a)
Dim b As Array(Of Double) = Rand(2, 2)
Console.WriteLine(b)
Dim c As Array(Of Byte) = Ones(Of Byte)(3, 3, 3)
Console.WriteLine(c)
Dim e As Array(Of Double) = ArrayFun(Function(f As Object()) CDbl(f(0)) + CDbl(f(1)) + CDbl(f(2)), a, b, c)
Console.WriteLine(e)
```
输出
```
1 0.4 -0.2 -0.8
列为第0维，行为第1维
0.238260880689258 0.879216326810055
0.549495699140008 0.567647208724007

列为第0维，行为第1维
(:,:,0)
1 1 1
1 1 1
1 1 1
(:,:,1)
1 1 1
1 1 1
1 1 1
(:,:,2)
1 1 1
1 1 1
1 1 1

列为第0维，行为第1维
(:,:,0)
2.23826088068926 2.87921632681005 2.23826088068926
1.94949569914001 1.96764720872401 1.94949569914001
1.03826088068926 1.67921632681005 1.03826088068926
0.749495699140008 0.767647208724007 0.749495699140008
(:,:,1)
2.23826088068926 2.87921632681005 2.23826088068926
1.94949569914001 1.96764720872401 1.94949569914001
1.03826088068926 1.67921632681005 1.03826088068926
0.749495699140008 0.767647208724007 0.749495699140008
(:,:,2)
2.23826088068926 2.87921632681005 2.23826088068926
1.94949569914001 1.96764720872401 1.94949569914001
1.03826088068926 1.67921632681005 1.03826088068926
0.749495699140008 0.767647208724007 0.749495699140008
```
## `ElMat`
大多数数组相关操作都在此模块中。
### `BsxFun`
<https://ww2.mathworks.cn/help/matlab/ref/bsxfun.html>

对两个数组应用按元素运算（启用隐式扩展）。不同于MATLAB，这里的隐式扩展更加健壮，采用了循环填充方式，使得允许`Ones(2, 2) + Ones(4, 4) = Ones(4, 4) + Ones(4, 4)`
```VB
Public Function BsxFun(Of TIn1, TIn2, TOut)(fun As Func(Of TIn1, TIn2, TOut), A As Array(Of TIn1), B As Array(Of TIn2)) As Array(Of TOut)
```
使用示例
```VB
BsxFun(Of T, T, T)(Function(c As Object, d As Object) DirectCast(CByte(c) + CByte(d), Object), A, B)
```
### `Cat`
<https://ww2.mathworks.cn/help/matlab/ref/cat.html>

沿维度 dim 串联 A1、A2、…、An。调用方应保证所有输入在串联维度以外的维度等长，此函数不会进行检查。
```VB
Public Function Cat(Of T)([dim] As Byte, ParamArray A As Array(Of T)()) As Array(Of T)
```
使用示例
```VB
Dim c As Array(Of Byte) = Zeros(Of Byte)(4, 4)
Dim g As Array(Of Byte) = Ones(Of Byte)(4, 4)
Console.WriteLine(Cat(2, c, g))
```
输出
```
列为第0维，行为第1维
(:,:,0)
0 0 0 0
0 0 0 0
0 0 0 0
0 0 0 0
(:,:,1)
1 1 1 1
1 1 1 1
1 1 1 1
1 1 1 1
```
### `NDims`
<https://ww2.mathworks.cn/help/matlab/ref/ndims.html>

返回数组 A 的维数。函数会忽略`Size(A, [dim]) = 1`所针对的尾部单一维度。
```VB
Public Function NDims(Of T)(A As Array(Of T)) As Byte
```
### `Numel`
<https://ww2.mathworks.cn/help/matlab/ref/numel.html>

返回数组 A 中的元素数目
```VB
Public Function Numel(Of T)(A As Array(Of T)) As UInteger
```
### `Ones`
<https://ww2.mathworks.cn/help/matlab/ref/ones.html>

返回由 1 组成的 sz1×...×szN `classname`数组，其中 sz1,...,szN 指示每个维度的大小。例如，`Ones(2, 3)`返回由 1 组成的 2×3 数组。
```VB
Public Function Ones(Of classname)(ParamArray sz As UInteger()) As Array(Of classname)
Public Function Ones(ParamArray sz As UInteger()) As Array(Of Double)
```
使用示例
```VB
Console.WriteLine(Ones(Of Byte)(3, 2, 1))
```
输出
```
列为第0维，行为第1维
1 1
1 1
1 1
```
### `Permute`
<https://ww2.mathworks.cn/help/matlab/ref/permute.html>

按照向量 dimorder 指定的顺序重新排列数组的维度。例如，`Permute(A, 1, 0)` 交换矩阵 A 的行和列维度。
```VB
Public Function Permute(Of T)(A As Array(Of T), ParamArray dimorder As Byte()) As Array(Of T)
```
使用示例
```VB
Dim b As Array(Of Double) = Rand(3, 3)
Console.WriteLine(b)
b = b.Permute(2, 0, 1)
Console.WriteLine(b)
```
输出
```
列为第0维，行为第1维
0.26053232851463 0.108105775019203 0.371179185514887
0.943869712736397 0.575122962973604 0.014786363120557
0.686558090935721 0.936864848219261 0.286453568509991

列为第0维，行为第1维
(:,:,0)
0.26053232851463 0.943869712736397 0.686558090935721
(:,:,1)
0.108105775019203 0.575122962973604 0.936864848219261
(:,:,2)
0.371179185514887 0.014786363120557 0.286453568509991
```
### `Reshape`
<https://ww2.mathworks.cn/help/matlab/ref/reshape.html>

将 A 重构为一个 sz1×...×szN 数组，其中 sz1,...,szN 指示每个维度的大小。可以指定`Nothing`的单个维度大小，以便自动计算维度大小，以使 B 中的元素数与 A 中的元素数相匹配。例如，如果 A 是一个 10×10 矩阵，则`Reshape(A, 2, 2, Nothing)`将 A 的 100 个元素重构为一个 2×2×25 数组。
```VB
Public Function Reshape(Of T)(A As Array(Of T), ParamArray sz As UInteger?()) As Array(Of T)
```
使用示例
```VB
Dim c As Array(Of Byte) = Colon(Of Byte)(1, 24)
Console.WriteLine(c)
c.Reshape(4, Nothing, 2)
Console.WriteLine(c)
```
输出
```
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24
列为第0维，行为第1维
(:,:,0)
1 5 9
2 6 10
3 7 11
4 8 12
(:,:,1)
13 17 21
14 18 22
15 19 23
16 20 24
```
### `Size`
<https://ww2.mathworks.cn/help/matlab/ref/size.html>
```VB
'返回一个向量，其元素包含 A 的相应维度的长度。例如，如果 A 是一个 3×4 矩阵，则Size(A)返回向量{3, 4}。sz 的长度为NDims(A)。
Public Function Size(Of T)(A As Array(Of T)) As UInteger()
'返回维度 dim 的长度。
Public Function Size(Of T)(A As Array(Of T), [dim] As Byte) As UInteger
```
### `Zeros`
<https://ww2.mathworks.cn/help/matlab/ref/zeros.html>

返回由零组成的 sz1×...×szN 数组，其中 sz1,...,szN 指示每个维度的大小。例如，`Zeros(2, 3)`将返回一个 2×3 矩阵。
```VB
Public Function Zeros(Of T)(ParamArray sz As UInteger()) As Array(Of T)
Public Function Zeros(ParamArray sz As UInteger()) As Array(Of Double)
```
使用示例
```VB
Console.WriteLine(Zeros(Of Byte)(4, 3, 2))
```
输出
```
列为第0维，行为第1维
(:,:,0)
0 0 0
0 0 0
0 0 0
0 0 0
(:,:,1)
0 0 0
0 0 0
0 0 0
0 0 0
```
## `ImageSci`
图像处理相关的实验性模块，目前仅包含一个函数`ImRead`
### `ImRead`
<https://ww2.mathworks.cn/help/matlab/ref/imread.html>

从`filename`指定的文件读取图像
```VB
''' <summary>
''' 不同于MATLAB，无论图片文件本身格式为何，此函数总是将返回高×宽×RGB[×帧]形式的<see cref="Byte"/>数组，即模块中列出的<see cref="GUID_WICPixelFormat32bppRGBA"/>格式。列出的其它格式只表示这些格式的图片文件可以被正确读取。
''' </summary>
''' <param name="filename">图片文件路径</param>
''' <param name="transparency">可选返回Alpha通道。如果返回多帧，将安排在第3维。</param>
''' <param name="Frames">对于多帧图像（如GIF），选择返回的帧序号。不同于MATLAB，从0开始。如果返回多帧，将安排在第4维。</param>
''' <returns>高×宽×RGB[×帧]形式的Byte数组</returns>
''' <exception cref="ComException"/>
Public Function ImRead(filename As String, Optional ByRef transparency As Array(Of Byte) = Nothing, Optional Frames As UInteger() = Nothing) As Array(Of Byte)
```
## `Ops`
此模块列举了所有可以直接以数组为单位进行的运算。`Array(Of T)`直接支持这些运算符，也可以调用函数。总之，不需要劳烦调用方遍历数组元素，直接可以得到结果数组。此外，所有的数组二元运算符都支持健壮的循环填充扩展，不同尺寸的数组都可以相互运算，结果数组各维长度等于所有数组在对应维长度的最大值。
### `Colon`
<https://ww2.mathworks.cn/help/matlab/ref/colon.html>

此函数对应MATLAB中的:运算符，在.Net系语言中不支持此运算符，所以以函数形式出现。
```VB
'创建一个包含元素 [j,j+1,j+2,...,j+m] 的单位间距向量 x，其中 m = fix(k-j)。如果 j 和 k 都是整数，则简化为 [j,j+1,...,k]。
Public Function Colon(Of T)(j As Double, k As Double) As T()
Public Function Colon(j As Double, k As Double) As Double()
'创建一个固定间隔向量 x，以 i 作为元素之间的增量。向量元素大致为 [j,j+i,j+2*i,...,j+m*i]，其中 m = fix((k-j)/i)。但是，如果 i 不是整数，则浮点算术运算的作用在于确定 colon 是否包括向量中的端点 k，因为 k 可能并不是正好等于 j+m*i。
Public Function Colon(j As Double, i As Double, k As Double) As Double()
Public Function Colon(Of T)(j As Double, i As Double, k As Double) As T()
```
注意此函数出于泛用性考虑返回的是`System.Array`一维数组
### `Eq`
<https://ww2.mathworks.cn/help/matlab/ref/eq.html>

确定相等性。对两个数组对应位置判断是否相等，返回`Boolean`结果存于新数组的对应位置。数组元素必须为基本数值类型或定义了=运算符。
```VB
Public Function Eq(Of T)(A As Array(Of T), B As Array(Of T)) As Array(Of Boolean)
Public Shared Operator =(A As Array(Of T), B As Array(Of T)) As Array(Of Boolean)
```
使用示例
```VB
Dim a As Array(Of Byte) = Ones(Of Byte)(2, 2)
Console.WriteLine(a)
Dim b As Array(Of Byte) = Ones(Of Byte)(3, 3)
Console.WriteLine(b)
Console.WriteLine(a = b)
```
输出
```
列为第0维，行为第1维
1 1
1 1

列为第0维，行为第1维
1 1 1
1 1 1
1 1 1

列为第0维，行为第1维
True True True
True True True
True True True
```
### `Gt`
<https://ww2.mathworks.cn/help/matlab/ref/gt.html>

确定大于。对两个数组对应位置判断左边是否大于右边，返回`Boolean`结果存于新数组的对应位置。数组元素必须为基本数值类型或定义了&gt;运算符。
```VB
Public Function Gt(Of T)(A As Array(Of T), B As Array(Of T)) As Array(Of Boolean)
Public Shared Operator >(A As Array(Of T), B As Array(Of T)) As Array(Of Boolean)
```
使用示例
```VB
Dim a As Array(Of Double) = Rand(2, 2)
Console.WriteLine(a)
Dim b As Array(Of Double) = Rand(3, 3)
Console.WriteLine(b)
Console.WriteLine(a > b)
```
输出
```
列为第0维，行为第1维
0.553207028914805 0.0845294893181554
0.244643434530424 0.054142762000739

列为第0维，行为第1维
0.401905045100444 0.190095289233185 0.268935535693977
0.47229299530028 0.0962769175396659 0.197517426310814
0.547434732107182 0.124121757282001 0.771332240556987

列为第0维，行为第1维
True False True
False False True
True False False
```
### `Lt`
<https://ww2.mathworks.cn/help/matlab/ref/lt.html>

确定小于。对两个数组对应位置判断左边是否小于右边，返回`Boolean`结果存于新数组的对应位置。数组元素必须为基本数值类型或定义了&lt;运算符。使用方法类似于`Gt`。
```VB
Public Function Lt(Of T)(A As Array(Of T), B As Array(Of T)) As Array(Of Boolean)
Public Shared Operator <(A As Array(Of T), B As Array(Of T)) As Array(Of Boolean)
```
### `Minus`
<https://ww2.mathworks.cn/help/matlab/ref/minus.html>

数组减法，每个元素的位置对应相减产生新数组，如果尺寸不匹配则循环填充扩展。数组元素必须为基本数值类型或定义了-运算符
```VB
Public Function Minus(Of T)(A As Array(Of T), B As Array(Of T)) As Array(Of T)
Public Shared Operator -(A As Array(Of T), B As Array(Of T)) As Array(Of T)
```
使用示例
```VB
Dim a As Array(Of Double) = Rand(2, 2)
Console.WriteLine(a)
Dim b As Array(Of Double) = Rand(3, 3)
Console.WriteLine(b)
Console.WriteLine(a - b)
```
输出
```
列为第0维，行为第1维
0.693930299810101 0.379898923626122
0.150769460085206 0.510617982833934

列为第0维，行为第1维
0.254892391271373 0.859994633058084 0.522447251026727
0.508427790137207 0.766492760631485 0.391172900046768
0.345911592871841 0.802284391039184 0.815554367758126

列为第0维，行为第1维
0.439037908538728 -0.480095709431961 0.171483048783375
-0.357658330052001 -0.255874777797551 -0.240403439961562
0.348018706938261 -0.422385467413061 -0.121624067948025
```
### `Ne`
<https://ww2.mathworks.cn/help/matlab/ref/ne.html>

确定不相等性。对两个数组对应位置判断是否不相等，返回`Boolean`结果存于新数组的对应位置。数组元素必须为基本数值类型或定义了&lt;&gt;运算符。使用方法类似于`Eq`
```VB
Public Function Ne(Of T)(A As Array(Of T), B As Array(Of T)) As Array(Of Boolean)
Public Shared Operator <>(A As Array(Of T), B As Array(Of T)) As Array(Of Boolean)
```
### `Plus`
<https://ww2.mathworks.cn/help/matlab/ref/plus.html>

数组加法，每个元素的位置对应相加产生新数组，如果尺寸不匹配则循环填充扩展。数组元素必须为基本数值类型或定义了+运算符。使用方法类似于`Minus`
```VB
Public Function Plus(Of T)(A As Array(Of T), B As Array(Of T)) As Array(Of T)
Public Shared Operator +(A As Array(Of T), B As Array(Of T)) As Array(Of T)
```
### `RDivide`
<https://ww2.mathworks.cn/help/matlab/ref/rdivide.html>

数组右除，每个元素的位置对应相乘产生新数组，如果尺寸不匹配则循环填充扩展。数组元素必须为基本数值类型或定义了/运算符。使用方法类似于`Minus`
```VB
Public Function RDivide(Of T)(A As Array(Of T), B As Array(Of T)) As Array(Of T)
Public Shared Operator /(A As Array(Of T), B As Array(Of T)) As Array(Of T)
```
暂不支持MATLAB中的矩阵除法
### `Times`
<https://ww2.mathworks.cn/help/matlab/ref/times.html>

数组点乘法，每个元素的位置对应相乘产生新数组，如果尺寸不匹配则循环填充扩展。数组元素必须为基本数值类型或定义了*运算符。使用方法类似于`Minus`
```VB
Public Function Times(Of T)(A As Array(Of T), B As Array(Of T)) As Array(Of T)
Public Shared Operator *(A As Array(Of T), B As Array(Of T)) As Array(Of T)
```
暂不支持MATLAB中的矩阵乘法
## `RandFun`
随机函数相关的模块，目前仅包含一个函数`Rand`
### `Rand`
<https://ww2.mathworks.cn/help/matlab/ref/rand.html>

返回由随机数组成的 sz1×...×szN 数组，其中 sz1,...,szN 指示每个维度的大小。例如：`Rand(3, 4)`返回一个 3×4 的矩阵。
```VB
Public Function Rand(ParamArray sz As UInteger()) As Array(Of Double)
```
使用示例
```VB
Console.WriteLine(Rand(3, 3, 3))
```
输出
```
列为第0维，行为第1维
(:,:,0)
0.373256412508551 0.436099485697271 0.785136860695266
0.646868123042802 0.320677443556803 0.275643454992978
0.881865931154166 0.323631366399876 0.525850586838019
(:,:,1)
0.34602423168068 0.795513515731093 0.144447271779388
0.35324898332043 0.429102965830408 0.858968644337248
0.665059330251561 0.10367835085079 0.309570575742782
(:,:,2)
0.784241557952129 0.382713779053983 0.246904421247032
0.484090017380235 0.382728654138152 0.514779767726911
0.495749614897999 0.63433096261431 0.371098600966436
```